# Resumo da Aula: Governança com Infra as Code (IaC) e Introdução ao Billing na AWS

## Introdução
Nesta aula, o professor aborda a **governança de infraestrutura** como pilar essencial do gerenciamento de custos em cloud, destacando o uso de **Infra as Code (IaC)** com ferramentas como **Pulumi** e **Terraform**. Ele enfatiza a importância de centralizar a criação de recursos em repositórios Git para controle, aprovação e rastreabilidade, evitando criações manuais via console que comprometem a governança e impactam os custos. A aula também antecipa a discussão sobre o **billing** da AWS, que será explorada em detalhes na próxima aula.

## Conteúdo Principal

### Governança com Infra as Code (IaC)
- **Conceito de IaC**:
  - **IaC (Infrastructure as Code)**: Prática de gerenciar infraestrutura por meio de arquivos de código declarativos, em vez de configurações manuais via console.
  - Ferramentas:
    - **Pulumi**: Mais amigável para desenvolvedores full stack, permitindo escrever infraestrutura em linguagens como JavaScript/TypeScript.
    - **Terraform**: Mais voltado para profissionais de SRE/infraestrutura, amplamente utilizado.
  - Ambas as ferramentas se encaixam no conceito de IaC, mas Pulumi foi abordado no curso por sua proximidade com desenvolvedores.
- **Importância para Custos**:
  - Criações manuais no console (ex.: criar um cluster EKS diretamente) geram custos inesperados e dificultam a governança.
  - IaC centraliza a definição de recursos em código, permitindo:
    - **Controle via SCM (Source Control Management)**: Recursos são declarados em repositórios Git, com revisões e aprovações (ex.: branch policies, pull requests).
    - **Rastreabilidade**: Identifica quem criou um recurso e por quê.
    - **Prevenção de duplicações**: Evita recursos redundantes, que aumentam custos desnecessariamente.
- **Boas Práticas**:
  - **Console com Permissões Restritas**: Configurar o console da AWS (ou outra cloud) com permissões apenas de leitura (*read-only*) para a maioria dos usuários, reservando permissões de escrita (*write*) para usuários root ou pipelines IaC.
  - **Aprovação de Mudanças**: Toda criação ou alteração de recursos deve passar por um processo de revisão no Git (ex.: PR aprovada por alguém com contexto de infraestrutura).
  - **Plugins de Custo**: Usar plugins no Pulumi/Terraform (ex.: steps em pipelines) para estimar custos de novos recursos durante a revisão de PRs (ex.: um cluster EKS adicionará ~$73/mês).
  - **Fonte da Verdade**: O código IaC (ex.: manifestos no Git) é a única fonte confiável da infraestrutura, não o console.

- **Exemplo Prático**:
  - Sem IaC: Um desenvolvedor cria um cluster EKS diretamente no console, gerando custos fixos ($0.10/h) sem controle. Isso pode levar a recursos duplicados ou esquecidos.
  - Com IaC: O cluster é definido em um manifesto Pulumi/Terraform, enviado a um repositório Git, revisado e aprovado. A pipeline aplica o recurso, e o revisor pode verificar o impacto no custo antes da criação.
  - Benefício: Evita surpresas no orçamento e facilita identificar recursos desnecessários.

- **Cenário Existente**:
  - Para infraestruturas já existentes sem IaC, é possível fazer o caminho inverso:
    - Gerar manifestos IaC a partir da infraestrutura atual (ex.: usando ferramentas como `terraform import` ou exportações do Pulumi).
    - Centralizar esses manifestos em um repositório Git para futura governança.

### Governança e Custos
- **Problema sem Governança**:
  - Criações manuais no console dificultam o rastreamento de recursos (ex.: quantos EC2s existem, quem os criou, qual o propósito).
  - Risco de custos inesperados (ex.: um EC2 ou EKS esquecido gera cobrança contínua).
- **Solução com IaC**:
  - Centraliza a gestão de recursos no código, com revisões e políticas.
  - Permite estimar custos antecipadamente (ex.: plugin na pipeline mostra que um EKS custará $73/mês).
  - Facilita auditorias e otimizações, identificando recursos duplicados ou ociosos.

### Próximos Passos
- **Billing na AWS**: A próxima aula explorará o **AWS Cost Explorer** e outras ferramentas de billing para monitoramento prático de custos.
- **Finalização do IaC**: Possível continuação do tema IaC, abordando mais detalhes ou práticas específicas.
- **Conexão com o Curso**: Revisitar conceitos do módulo de Pulumi para reforçar a governança e integrar com o gerenciamento de custos.

### Boas Práticas
- **Permissões Restritas**: Configurar o console da AWS para *read-only* na maioria dos casos, reservando *write* para pipelines IaC.
- **Revisão de PRs**: Implementar políticas de aprovação em repositórios Git para todas as alterações de infraestrutura.
- **Estimativas de Custo em Pipelines**: Usar plugins de IaC para calcular impactos financeiros antes de aplicar mudanças.
- **Fonte da Verdade**: Garantir que o código IaC seja a única referência para a infraestrutura, evitando configurações manuais.
- **Auditoria Regular**: Revisar recursos criados para eliminar duplicações ou ociosidade, reduzindo custos.

## Conclusão
A aula destaca a **governança de infraestrutura** como essencial para o gerenciamento de custos, com o **IaC** (usando Pulumi ou Terraform) sendo obrigatório para centralizar, controlar e rastrear recursos. A prática evita criações manuais no console, reduz custos inesperados e facilita auditorias. A integração com repositórios Git e plugins de estimativa de custo reforça a transparência e a responsabilidade. A próxima aula abordará o **billing** na AWS, conectando governança e monitoramento prático para otimizar custos no stack de DevOps da Rocketseat.